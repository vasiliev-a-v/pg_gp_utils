Состав:
1)search_and_kill_orphaned_sessions_bash.txt-bash скрипт,который запускает скрипт поиска "осиротевших" процессов, а также скрипт отстрела этих процессов.
	Если процессов не обнаружено, то отстрел не запускается. Описание работы скрипта описано в файле скрипта.
2)search_hung_fin.sql- sql-скрипт, ищущий "осиротевшие процессы".
3)kill_hung_query_fin.sql- sql-скрипт, отстреливающий пиды соответствующие определенным пидам, которые соответствуют определенной сессии. Подробное описание работы скрипта описано
	в файле скрипта.

Настройка:
1)Перенести файлы скриптов на мастер сервер кластера Greenplum
2)В файле search_and_kill_orphaned_sessions_bash
  2.1 В строке "arr=( $(psql -Atq -F ';' -d dwh -U gpadmin -f /tmp/search_hung_fin.sql | cut -d';' -f1))" 
		-вместо /tmp/search_hung_fin.sql указать путь к файлу  search_hung_fin.sql
  2.2 В строке "psql -d template1 -U gpadmin --set=sess_id=$i -f /tmp/kill_hung_query.sql;"
		-вместо /tmp/kill_hung_query.sql указать путь к файлу kill_hung_query_fin.sql 
3)В файле search_hung_fin.sql
  3.1 В строках "create table if not exists public.search_hung_result" и "insert into public.search_hung_result"
		-вместо public.search_hung_result указать желаемую схему и имя таблицы, куда будет собираться информация о найденных пидах

Порядок работы:
1)Запускаем search_and_kill_orphaned_sessions_bash.txt периодически. Периодичность запуска определеяется самостоятельно.
	Результат работы скрипта(пиды,которые попали под критерии "осиротевших" процессов и которым была направлена команда pg_terminate_backend()) 
накапливаются в таблице public.search_hung_result,если не было указано иного согласно п. 3.1 раздела "настройка".Для каждого пида сохраняется отдельная строка,
в которой указываются: 
	номер сессии к которой он относится,
	id юзера к которому он относится,
	имя юзера к которому он относится,
	текст запроса кототрый он выполнял
	номер сегмента на котором он находится,
	имя хоста на котором он находится,
	время старта этого процесса,
	время когда этот процесс был обнаружен.
	Логи отстрела хранятся в директории home/gpadmin/gpAdminlogs/kill_hung_query_<date>, где date это дата запуска.
2)Смотрим таблицу, в которой сохраняются пиды, к которым была применена команда pg_terminate_backend().
	-Если пид появляется один раз, в таблице, то значит пид был успешно отстрелен
	-Если пид продолжает появляться в таблице, это значит что данный пид убить pg_terminate_backend() нельзя. В таком случае
нужно собрать логи работы отстрельщика(home/gpadmin/gpAdminlogs/kill_hung_query_<date>) и создать обращение на вендора, ждать дальнейших указаний. Убивать такой процесс командами ОС
самостоятельно на работающей базе нельзя. 
